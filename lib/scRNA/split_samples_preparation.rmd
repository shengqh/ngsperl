---
title: "HTO preparation"
date: "`r format(Sys.Date(), '%m/%d/%Y')`"
output: 
  rmdformats::readthedown:
    toc_depth: 2
---

```{r setup, include=FALSE}
library(knitr)
library(dplyr)
library(kableExtra)
knitr::opts_chunk$set(echo=FALSE,  message=FALSE, warning=FALSE, results = 'asis', fig.width=7, fig.height = 7,tidy = TRUE, tidy.opts = list(comment = FALSE))
```

```{css, echo=FALSE}
#content{
    max-width:1920px;
}
```

```{r, child="reportFunctions.Rmd", include=FALSE} 
```

```{r data, echo = FALSE}
options_table<-read.table("fileList2.txt", sep="\t", header=F, stringsAsFactors = F)
myoptions<-split(options_table$V1, options_table$V2)

outFile=myoptions$task_name

sample_files<-read.table("fileList1.txt", sep="\t", header=F, stringsAsFactors = F)
samples<-sample_files$V2

printTable<-function(filepath){
  tbl<-read.csv(filepath, check.names=F, row.names=1)
  print(kable_styling(kable(tbl)))
}

getTable<-function(filepath){
  return(paste0("```{r,echo=FALSE,results='asis'}\nprintTable('", filepath, "')\n```\n\n"))
}

getFigure<-function(filepath){
  return(paste0("```{r,echo=FALSE,results='asis'}\ncheck_and_include_graphics('", basename(filepath), "')\n```\n\n"))
}

resFile<-"sub.Rmd"
figureRmd<-function(samples){
  result<-""
  sample = samples[1]
  for(sample in samples){
    result<-paste0(result, paste0("\n\n# ", sample, "\n\n"))

    result<-paste0(result, paste0("\n\n## All raw tags\n\n"))
    result<-paste0(result, getFigure(paste0(sample, ".raw.alltags.png")))
    
    result<-paste0(result, paste0("\n\n## Filtered tags\n\n"))
    result<-paste0(result, getFigure(paste0(sample, ".tag.dist.png")))
  }
  return(result)
}
cat(figureRmd(samples), file=resFile)

```

```{r, child=resFile} 
```

